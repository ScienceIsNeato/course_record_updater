{
  "demo_name": "Full Semester Lifecycle Story",
  "demo_id": "full_semester_story",
  "version": "3.0",
  "description": "A structured walkthrough of the semester lifecycle: planning (creating terms/offerings), onboarding (inviting faculty), and auditing (reviewing outcomes).",
  "estimated_duration_minutes": 20,
  "talking_points": [
    "System Date Override allows testing full semester cycles in minutes",
    "Streamlined faculty onboarding via email invitations",
    "Closed-loop audit workflow ensures data quality",
    "Real-time status updates across dashboards"
  ],
  "environment": {
    "working_directory": ".",
    "setup_commands": [
      "source venv/bin/activate && source .envrc",
      "python scripts/seed_db.py --demo --manifest demos/full_semester_manifest.json --clear --env dev",
      "./scripts/restart_server.sh dev"
    ],
    "base_url": "http://localhost:3001",
    "cleanup_commands": []
  },
  "steps": [
    {
      "step_number": 1,
      "phase": "Act 1: Planning (Oct 2025)",
      "name": "Verify Environment & Date",
      "purpose": "Confirm date override is active for the Fall 2025 planning phase",
      "pre_commands": [],
      "instructions": {
        "human": "The server has been seeded with the Institution Admin date set to Oct 15, 2025.\n\nLogin as 'demo2025.admin@example.com' (Password: Demo2025!).\nNotice the yellow 'System Date Override' banner.",
        "automated": {
          "action": "api_post",
          "endpoint": "/api/auth/login",
          "data": {
            "email": "demo2025.admin@example.com",
            "password": "Demo2025!"
          },
          "description": "Login as Sarah Admin"
        }
      },
      "urls": [
        {
          "label": "Login Page",
          "url": "http://localhost:3001/login",
          "clickable": true
        }
      ],
      "inputs": {
        "email": "demo2025.admin@example.com",
        "password": "Demo2025!"
      },
      "expected_results": [
        "Dashboard loads",
        "Banner shows: 'System Date Override Active: Oct 15, 2025'"
      ],
      "post_commands": [],
      "verification": {
        "type": "ui_check",
        "expected_url": "/dashboard"
      },
      "artifacts": {
        "screenshots": [
          "01_act1_dashboard_banner.png"
        ]
      },
      "pause_for_human": true
    },
    {
      "step_number": 2,
      "phase": "Act 1: Planning (Oct 2025)",
      "name": "Create Spring 2026 Term",
      "purpose": "Prepare for the upcoming semester",
      "pre_commands": [],
      "instructions": {
        "human": "Navigate to 'Terms' from the dashboard.\nClick 'Create New Term'.\n\nEnter Details:\n- Name: Spring 2026\n- Code: SP2026\n- Start: Jan 15, 2026\n- End: May 15, 2026\n- Assessment Due: May 20, 2026\n\nClick 'Create Term'.",
        "automated": {
          "action": "api_post",
          "endpoint": "/api/terms",
          "data": {
            "name": "Spring 2026",
            "code": "SP2026",
            "start_date": "2026-01-15",
            "end_date": "2026-05-15",
            "assessment_due_date": "2026-05-20"
          },
          "description": "Create SP2026 term"
        }
      },
      "urls": [],
      "inputs": {
        "name": "Spring 2026",
        "code": "SP2026"
      },
      "expected_results": [
        "Spring 2026 term appears in list with 'Upcoming' status"
      ],
      "post_commands": [
        {
          "command": "sqlite3 course_records_dev.db \"SELECT id FROM terms WHERE code='SP2026' LIMIT 1\"",
          "purpose": "Capture SP2026 ID",
          "capture_output_as": "sp26_term_id"
        }
      ],
      "verification": {
        "type": "db_check"
      },
      "artifacts": {},
      "pause_for_human": true
    },
    {
      "step_number": 3,
      "phase": "Act 1: Planning (Oct 2025)",
      "name": "Create Course Offering",
      "purpose": "Create offering for BIOL-101 in the new Spring 2026 term",
      "pre_commands": [
        {
          "command": "sqlite3 course_records_dev.db \"SELECT id FROM courses WHERE course_number='BIOL-101' LIMIT 1\"",
          "purpose": "Get BIOL-101 ID",
          "capture_output_as": "biol101_id"
        },
        {
          "command": "sqlite3 course_records_dev.db \"SELECT id FROM programs WHERE short_name='ZOOL' LIMIT 1\"",
          "purpose": "Get Zoology Program ID",
          "capture_output_as": "zool_program_id"
        }
      ],
      "instructions": {
        "human": "Navigate to 'Course Offerings'.\nClick 'Create New Course Offering'.\n\nSelect:\n- Course: BIOL-101\n- Term: Spring 2026\n- Program: Biology (or Zoology)\n\n(Sections: Use default '001')\n\nClick 'Create Offering'.",
        "automated": {
          "action": "api_post",
          "endpoint": "/api/offerings",
          "data": {
            "course_id": "{{biol101_id}}",
            "term_id": "{{sp26_term_id}}",
            "program_id": "{{zool_program_id}}",
            "sections": [
              {
                "section_number": "001"
              }
            ]
          },
          "description": "Create SP2026 offering for BIOL-101"
        }
      },
      "urls": [],
      "inputs": {
        "course": "BIOL-101",
        "term": "SP2026"
      },
      "expected_results": [
        "Course offering created for BIOL-101 in Spring 2026",
        "Section 001 automatically created"
      ],
      "post_commands": [
        {
          "command": "sqlite3 course_records_dev.db \"SELECT id FROM course_offerings WHERE course_id='{{biol101_id}}' AND term_id='{{sp26_term_id}}' LIMIT 1\"",
          "purpose": "Capture offering ID",
          "capture_output_as": "sp26_offering_id"
        },
        {
          "command": "sqlite3 course_records_dev.db \"SELECT id FROM course_sections WHERE section_number='001' AND offering_id='{{sp26_offering_id}}' LIMIT 1\"",
          "purpose": "Capture Section 001 ID",
          "capture_output_as": "section_001_id"
        }
      ],
      "verification": {
        "type": "db_check"
      },
      "artifacts": {},
      "pause_for_human": true
    },
    {
      "step_number": 4,
      "phase": "Act 2: Onboarding (Oct 2025)",
      "name": "Invite New Faculty",
      "purpose": "Onboard new faculty member for the new section",
      "pre_commands": [],
      "instructions": {
        "human": "Navigate to the 'Course Sections' panel (or page).\nFind 'BIOL-101 (Section 001)' for Spring 2026.\nClick the 'Invite Instructor' (user-plus) icon.\n\nIn the modal:\n- Email: dr.newguy@example.com\n- First Name: New\n- Last Name: Guy\n- Section: BIOL-101 - Section 001 (Should be pre-selected)\n\nClick 'Send Invitation'.",
        "automated": {
          "action": "api_post",
          "endpoint": "/api/invitations",
          "data": {
            "email": "dr.newguy@example.com",
            "first_name": "New",
            "last_name": "Guy",
            "role": "instructor",
            "section_id": "{{section_001_id}}"
          },
          "description": "Invite Dr. Newguy to Section 001"
        }
      },
      "urls": [],
      "inputs": {
        "email": "dr.newguy@example.com",
        "section": "001"
      },
      "expected_results": [
        "Invitation sent successfully",
        "Section status updates to 'Assigned' (or pending)"
      ],
      "post_commands": [],
      "verification": {
        "type": "db_check"
      },
      "artifacts": {
        "logs": [
          "email.log"
        ]
      },
      "pause_for_human": true
    },
    {
      "step_number": 5,
      "phase": "Act 2: Onboarding (Oct 2025)",
      "name": "Faculty Registration",
      "purpose": "Simulate new faculty accepting invitation",
      "pre_commands": [
        {
          "command": "sqlite3 course_records_dev.db \"SELECT token FROM user_invitations WHERE email='dr.newguy@example.com' ORDER BY created_at DESC LIMIT 1\"",
          "purpose": "Get invitation token",
          "capture_output_as": "invite_token"
        }
      ],
      "instructions": {
        "human": "Logout as Admin.\n(In a real flow, checking email) -> Simulate clicking the invite link.\n\nSimulate Invite Acceptance:\n- Token: (hidden)\n- Password: Password123!\n- Display Name: Dr. New Guy\n\nLogin as 'dr.newguy@example.com' and verify visualization of the assigned course.",
        "automated": {
          "action": "sequence",
          "steps": [
            {
              "action": "api_post",
              "endpoint": "/api/auth/logout",
              "data": {}
            },
            {
              "action": "api_post",
              "endpoint": "/api/auth/accept-invitation",
              "data": {
                "invitation_token": "{{invite_token}}",
                "password": "Password123!",
                "display_name": "Dr. New Guy"
              }
            }
          ]
        }
      },
      "urls": [],
      "inputs": {
        "email": "dr.newguy@example.com"
      },
      "expected_results": [
        "Account created",
        "Logged in as Dr. New Guy",
        "Dashboard shows BIOL-101 SP26"
      ],
      "post_commands": [],
      "verification": {
        "type": "ui_check"
      },
      "artifacts": {},
      "pause_for_human": true
    },
    {
      "step_number": 6,
      "phase": "Act 3: Semester End (Dec 2025)",
      "name": "Time Jump: Dec 20, 2025",
      "purpose": "Advance timeline to end of Fall semester to audit previous terms",
      "pre_commands": [],
      "instructions": {
        "human": "Logout Dr. New Guy.\nLogin as 'demo2025.admin@example.com' (Demo2025!).\n\nUse the Date Override feature to jump to: December 20, 2025.\nThis simulates the end of the Fall 2025 semester for auditing purposes.",
        "automated": {
          "action": "sequence",
          "steps": [
            {
              "action": "api_post",
              "endpoint": "/api/auth/logout",
              "data": {}
            },
            {
              "action": "api_post",
              "endpoint": "/api/auth/login",
              "data": {
                "email": "demo2025.admin@example.com",
                "password": "Demo2025!"
              }
            },
            {
              "action": "api_post",
              "endpoint": "/api/profile/system-date",
              "data": {
                "system_date": "2025-12-20T09:00:00"
              }
            }
          ]
        }
      },
      "urls": [],
      "inputs": {
        "date": "2025-12-20"
      },
      "expected_results": [
        "Date Banner: Dec 20, 2025",
        "Audit tasks become visible"
      ],
      "post_commands": [],
      "verification": {
        "type": "ui_check"
      },
      "artifacts": {
        "screenshots": [
          "02_act3_date_jump.png"
        ]
      },
      "pause_for_human": true
    },
    {
      "step_number": 7,
      "phase": "Act 3: Semester End (Dec 2025)",
      "name": "Audit Queue Review",
      "purpose": "Review submissions from Fall 2025",
      "pre_commands": [],
      "instructions": {
        "human": "Navigate to 'Audit CLO' page.\nReview the list:\n- Identify the submission for BIOL-101 (Seeded with 'Rework Needed' status/content).\n- Identify the missing submission for ZOOL-101.",
        "automated": {
          "action": "none",
          "url": "/audit-clo"
        }
      },
      "urls": [],
      "inputs": {},
      "expected_results": [
        "Audit table loaded"
      ],
      "post_commands": [],
      "verification": {
        "type": "ui_check"
      },
      "artifacts": {},
      "pause_for_human": true
    },
    {
      "step_number": 8,
      "phase": "Act 3: Semester End (Dec 2025)",
      "name": "Request Rework",
      "purpose": "Flag incorrect data for correction",
      "pre_commands": [
        {
          "command": "sqlite3 course_records_dev.db \"SELECT id FROM course_outcomes WHERE clo_number='4' AND description LIKE '%basket%' LIMIT 1\"",
          "purpose": "Find the seeded 'Bad' CLO",
          "capture_output_as": "bad_clo_id"
        }
      ],
      "instructions": {
        "human": "Click 'Request Rework' on the BIOL-101 CLO #4.\nComment: 'Description mismatch. Please correct copy/paste error.'\nConfirm.",
        "automated": {
          "action": "api_post",
          "endpoint": "/api/outcomes/{{bad_clo_id}}/request-rework",
          "data": {
            "comments": "Description mismatch. Please correct copy/paste error."
          },
          "description": "Flag CLO for rework"
        }
      },
      "urls": [],
      "inputs": {
        "comment": "Description mismatch"
      },
      "expected_results": [
        "Status changes to Needs Rework"
      ],
      "post_commands": [],
      "verification": {
        "type": "db_check"
      },
      "artifacts": {},
      "pause_for_human": true
    },
    {
      "step_number": 9,
      "phase": "Act 4: Correction (Dec 2025)",
      "name": "Faculty Fixes Rework",
      "purpose": "Faculty member correcting their submission",
      "pre_commands": [],
      "instructions": {
        "human": "Logout Admin.\nLogin as 'dr.morgan@demo.example.com' (Instructor123!).\n\nNotice the 'Needs Rework' badge.\nEdit CLO #4: Change 'Basket Weaving' -> 'Scientific Method'.\nResubmit.",
        "automated": {
          "action": "sequence",
          "steps": [
            {
              "action": "api_post",
              "endpoint": "/api/auth/logout",
              "data": {}
            },
            {
              "action": "api_post",
              "endpoint": "/api/auth/login",
              "data": {
                "email": "dr.morgan@demo.example.com",
                "password": "Instructor123!"
              }
            },
            {
              "action": "api_put",
              "endpoint": "/api/outcomes/{{bad_clo_id}}",
              "data": {
                "description": "Demonstrate proficiency in Scientific Method",
                "status": "submitted"
              }
            }
          ]
        }
      },
      "urls": [],
      "inputs": {
        "description": "Scientific Method"
      },
      "expected_results": [
        "CLO status updated to Submitted"
      ],
      "post_commands": [],
      "verification": {
        "type": "db_check"
      },
      "artifacts": {},
      "pause_for_human": true
    },
    {
      "step_number": 10,
      "phase": "Act 5: Closeout (Jan 2026)",
      "name": "Final Approvals",
      "purpose": "Admin approves fixed data and closes non-compliant items",
      "pre_commands": [
        {
          "command": "sqlite3 course_records_dev.db \"SELECT id FROM course_outcomes WHERE clo_number='5' AND description LIKE '%unicorns%' LIMIT 1\"",
          "purpose": "Find the seeded 'NCI' CLO (Unicorns)",
          "capture_output_as": "nci_clo_id"
        }
      ],
      "instructions": {
        "human": "Logout Dr. Morgan.\nLogin as 'demo2025.admin@example.com'.\n\nNavigate to Audit.\n1. Verify CLO #4 is fixed. Click 'Approve'.\n2. Locate ZOOL-101 CLO #5. Click 'Mark NCI' (Never Coming In). Comment: 'Faculty unreachable'.\n\nAudit queue should be clear.",
        "automated": {
          "action": "sequence",
          "steps": [
            {
              "action": "api_post",
              "endpoint": "/api/auth/logout",
              "data": {}
            },
            {
              "action": "api_post",
              "endpoint": "/api/auth/login",
              "data": {
                "email": "demo2025.admin@example.com",
                "password": "Demo2025!"
              }
            },
            {
              "action": "api_post",
              "endpoint": "/api/management/audit/{{bad_clo_id}}/approve",
              "data": {},
              "description": "Approve fixed CLO #4"
            },
            {
              "action": "api_post",
              "endpoint": "/api/management/audit/{{nci_clo_id}}/nci",
              "data": {
                "admin_comment": "Faculty unreachable."
              },
              "description": "Mark CLO #5 as NCI"
            }
          ]
        }
      },
      "urls": [],
      "inputs": {},
      "expected_results": [
        "Items removed from queue",
        "Fall 2025 closeout complete"
      ],
      "post_commands": [],
      "verification": {
        "type": "ui_check"
      },
      "artifacts": {
        "screenshots": [
          "04_final_dashboard.png"
        ]
      },
      "pause_for_human": true
    },
    {
      "step_number": 11,
      "phase": "Completion",
      "name": "Demo Complete",
      "purpose": "Wrap up",
      "pre_commands": [],
      "instructions": {
        "human": "Demo successfully completed. \nShown: Planning (SP26), Onboarding (Invite/Register), and Audit (FA25 Closeout).",
        "automated": {
          "action": "none"
        }
      },
      "urls": [],
      "inputs": {},
      "expected_results": [],
      "post_commands": [],
      "verification": {
        "type": "none"
      },
      "artifacts": {},
      "pause_for_human": false
    }
  ]
}