[pytest]
pythonpath = src .
testpaths = tests/unit tests/integration tests/smoke tests/e2e tests/third_party
python_files = test_*.py
python_classes = Test*
python_functions = test_*
addopts = --strict-markers
markers =
    slow: marks tests as slow (deselect with '-m "not slow"')
    integration: marks tests as integration tests (run against SQLite persistence)
    unit: marks tests as unit tests
    smoke: marks critical path sanity checks (server health, login)
    e2e: marks tests as E2E tests (Playwright browser automation, excluded from coverage)
    third_party: marks tests as third-party integration tests (external services like Ethereal Email)

# =============================================================================
# RUNNING TESTS - USE ship_it.py AS PRIMARY INTERFACE
# =============================================================================
#
# ship_it.py handles venv activation, environment variables, parallel execution,
# and coverage enforcement. Always prefer it over raw pytest:
#
#   python scripts/ship_it.py --checks commit           # Full commit validation
#   python scripts/ship_it.py --checks python-unit-tests  # Unit tests only
#   python scripts/ship_it.py --checks tests coverage   # Tests + coverage
#
# Dev-cycle shortcuts (for rapid iteration on a specific test file):
#   python scripts/ship_it.py --checks python-unit-tests  # Fast: all unit tests
#   pytest tests/unit/test_my_file.py -x -q               # Single file, stop on fail
#   pytest tests/unit/ -m "not slow" -x -q                # Skip slow, stop on fail
#   pytest tests/unit/ --lf -q                            # Re-run last-failed only
#
# NOTE: Direct pytest is acceptable for single-file verification during dev,
# but always validate with ship_it.py before committing.
# =============================================================================

# Asyncio configuration to suppress deprecation warnings
asyncio_default_fixture_loop_scope = function
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
