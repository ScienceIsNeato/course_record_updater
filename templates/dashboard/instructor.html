{% extends "dashboard/base_dashboard.html" %}

{% block title %}Instructor Dashboard - Loopcloser{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='panels.css') }}">
{% endblock %}

{% block nav_items %}
<button class="nav-link btn btn-link" type="button" id="dashboard-view-all" onclick="filterDashboard('all')"><i
        class="fas fa-tachometer-alt me-1"></i>Dashboard</button>
<button class="nav-link btn btn-link" type="button" id="dashboard-assessments"
    onclick="filterDashboard('assessments')"><i class="fas fa-tasks me-1"></i>Assessments</button>
<button class="nav-link btn btn-link" type="button" id="dashboard-sections" onclick="filterDashboard('sections')"><i
        class="fas fa-layer-group me-1"></i>Sections</button>
{% endblock %}

{% block page_title %}üë®‚Äçüè´ Instructor Dashboard{% endblock %}
{% block page_subtitle %}Complete course assessments and monitor progress{% endblock %}

{% block content %}
<div class="header-stats">
    <span id="instructorName">{{ user.first_name }} {{ user.last_name }}</span>
    <div class="stat-item" data-stat="courses">
        [<span class="stat-number" id="instructorCourseCount">0</span> Courses]
    </div>
    <div class="stat-item" data-stat="sections">
        [<span class="stat-number" id="instructorSectionCount">0</span> Sections]
    </div>
    <div class="stat-item" data-stat="students">
        [<span class="stat-number" id="instructorStudentCount">0</span> Students]
    </div>
    <div class="stat-item" data-stat="assessments">
        [<span class="stat-number" id="instructorAssessmentProgress">0%</span> CLO Progress]
    </div>
    <div class="header-actions ms-auto">
        <!-- Removed manual refresh - data auto-refreshes after mutations -->
    </div>
</div>



<!-- Panel 2: Assessment Tasks -->
<div class="dashboard-panel" id="instructor-assessment-panel">
    <div class="panel-header">
        <h5 class="panel-title">
            <span class="panel-icon">‚è∞</span>
            Assessment Tasks
        </h5>
        <div class="panel-actions">
            <button class="btn btn-sm btn-outline-secondary" onclick="window.location.href='/assessments'">
                <i class="fas fa-tasks"></i> Complete Assessments
            </button>
        </div>
        <button class="panel-toggle">‚ñº</button>
    </div>
    <div class="panel-content">
        <div id="instructorAssessmentContainer">
            <div class="panel-loading">
                <div class="spinner-border spinner-border-sm"></div>
                Loading assessment tasks...
            </div>
        </div>
    </div>
</div>

<!-- Panel 3: Course Sections -->
<div class="dashboard-panel" id="instructor-sections-panel">
    <div class="panel-header">
        <h5 class="panel-title">
            <span class="panel-icon">üìö</span>
            Course Sections
        </h5>
        <button class="panel-toggle">‚ñº</button>
    </div>
    <div class="panel-content">
        <div id="instructorSummaryContainer">
            <div class="panel-loading">
                <div class="spinner-border spinner-border-sm"></div>
                Building summary...
            </div>
        </div>
    </div>
</div>

<!-- Panel 5: Data Management (Export Only) -->
{% include 'components/data_management_panel.html' %}
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='logger.js') }}"></script>
<script src="{{ url_for('static', filename='script.js') }}"></script>
<script src="{{ url_for('static', filename='panels.js') }}"></script>
<script src="{{ url_for('static', filename='dashboard_utils.js') }}"></script>
<script src="{{ url_for('static', filename='dashboard_navigation.js') }}"></script>
<script src="{{ url_for('static', filename='instructor_dashboard.js') }}"></script>
<script>
    // Configure dashboard navigation for Instructor role
    configureDashboardFilter(
        {
            'assessments': ['instructor-assessment-panel'],
            'sections': ['instructor-sections-panel'],
            'all': ['instructor-assessment-panel', 'instructor-sections-panel', 'data-management-panel']
        },
        [
            'instructor-assessment-panel',
            'instructor-sections-panel',
            'data-management-panel'
        ]
    );

    // Instructor Data Management Functions (Export Only)
    function instructorQuickExport() {
        const format = document.querySelector('input[name="instructorExportFormat"]:checked').value;
        alert(`Quick Export (${format}) feature coming soon!`);
    }

    function instructorExportData(type) {
        const format = document.querySelector('input[name="instructorExportFormat"]:checked').value;
        alert(`Export ${type} (${format}) feature coming soon!`);
    }
</script>
{% endblock %}
