{% extends "dashboard/base_dashboard.html" %}

{% block title %}Institution Administrator Dashboard - MockU Course Admin{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='panels.css') }}">
{% endblock %}

{% block nav_items %}
<a class="nav-link" href="/dashboard"><i class="fas fa-tachometer-alt me-1"></i>Dashboard</a>
<button class="nav-link btn btn-link" type="button"><i class="fas fa-graduation-cap me-1"></i>Programs</button>
<button class="nav-link btn btn-link" type="button"><i class="fas fa-users me-1"></i>Faculty</button>
<button class="nav-link btn btn-link" type="button"><i class="fas fa-chart-bar me-1"></i>Outcomes</button>
{% endblock %}

{% block page_title %}üèõÔ∏è Institution Administration{% endblock %}
{% block page_subtitle %}Manage programs, faculty, and outcomes{% endblock %}

{% block content %}
<div class="header-stats">
    <span id="institutionName">{{ user.institution_name or 'Institution Overview' }}</span>
    <span>Current Term: <strong id="currentTermName">--</strong></span>
    <div class="stat-item" data-stat="programs">
        [<span class="stat-number" id="programCount">0</span> Programs]
    </div>
    <div class="stat-item" data-stat="courses">
        [<span class="stat-number" id="courseCount">0</span> Courses]
    </div>
    <div class="stat-item" data-stat="faculty">
        [<span class="stat-number" id="facultyCount">0</span> Faculty]
    </div>
    <div class="stat-item" data-stat="sections">
        [<span class="stat-number" id="sectionCount">0</span> Sections]
    </div>
    <div class="header-actions ms-auto">
        <button type="button" class="btn btn-sm btn-outline-primary" id="institutionRefreshButton">
            <i class="fas fa-sync-alt"></i> Refresh
        </button>
        <span class="last-updated" id="institutionLastUpdated">Last updated: --</span>
    </div>
</div>

<!-- Panel 1: Program Management -->
<div class="dashboard-panel" id="institution-program-panel">
    <div class="panel-header">
        <h5 class="panel-title">
            <span class="panel-icon">üìö</span>
            Program Management
        </h5>
        <div class="panel-actions">
            <button class="btn btn-sm btn-primary" onclick="createProgram()">
                <i class="fas fa-plus"></i> Add Program
            </button>
            <button class="btn btn-sm btn-outline-secondary" onclick="managePrograms()">
                <i class="fas fa-sliders-h"></i> Manage Programs
            </button>
        </div>
        <button class="panel-toggle">‚ñº</button>
    </div>
    <div class="panel-content">
        <div id="programManagementContainer">
            <div class="panel-loading">
                <div class="spinner-border spinner-border-sm"></div>
                Loading programs...
            </div>
        </div>
    </div>
</div>

<!-- Panel 2: Course Management -->
<div class="dashboard-panel" id="institution-course-panel">
    <div class="panel-header">
        <h5 class="panel-title">
            <span class="panel-icon">üìö</span>
            Course Management
        </h5>
        <div class="panel-actions">
            <button class="btn btn-sm btn-primary" onclick="createCourse()">
                <i class="fas fa-plus"></i> Add Course
            </button>
            <button class="btn btn-sm btn-outline-secondary" onclick="manageCourses()">
                <i class="fas fa-list"></i> Manage Courses
            </button>
        </div>
        <button class="panel-toggle">‚ñº</button>
    </div>
    <div class="panel-content">
        <div id="courseManagementContainer">
            <div class="panel-loading">
                <div class="spinner-border spinner-border-sm"></div>
                Loading courses...
            </div>
        </div>
    </div>
</div>

<!-- Panel 3: Term Management -->
<div class="dashboard-panel" id="institution-term-panel">
    <div class="panel-header">
        <h5 class="panel-title">
            <span class="panel-icon">üìÖ</span>
            Term Management
        </h5>
        <div class="panel-actions">
            <button class="btn btn-sm btn-primary" onclick="createTerm()">
                <i class="fas fa-plus"></i> Add Term
            </button>
            <button class="btn btn-sm btn-outline-secondary" onclick="manageTerms()">
                <i class="fas fa-list"></i> Manage Terms
            </button>
        </div>
        <button class="panel-toggle">‚ñº</button>
    </div>
    <div class="panel-content">
        <div id="termManagementContainer">
            <div class="panel-loading">
                <div class="spinner-border spinner-border-sm"></div>
                Loading terms...
            </div>
        </div>
    </div>
</div>

<!-- Panel 4: Offering Management -->
<div class="dashboard-panel" id="institution-offering-panel">
    <div class="panel-header">
        <h5 class="panel-title">
            <span class="panel-icon">üìã</span>
            Course Offerings (Current Term)
        </h5>
        <div class="panel-actions">
            <button class="btn btn-sm btn-primary" onclick="createOffering()">
                <i class="fas fa-plus"></i> Add Offering
            </button>
            <button class="btn btn-sm btn-outline-secondary" onclick="manageOfferings()">
                <i class="fas fa-list"></i> Manage Offerings
            </button>
        </div>
        <button class="panel-toggle">‚ñº</button>
    </div>
    <div class="panel-content">
        <div id="offeringManagementContainer">
            <div class="panel-loading">
                <div class="spinner-border spinner-border-sm"></div>
                Loading offerings...
            </div>
        </div>
    </div>
</div>

<!-- Panel 5: Faculty Overview -->
<div class="dashboard-panel" id="institution-faculty-panel">
    <div class="panel-header">
        <h5 class="panel-title">
            <span class="panel-icon">üë®‚Äçüè´</span>
            Faculty Overview
        </h5>
        <div class="panel-actions">
            <button class="btn btn-sm btn-success" onclick="openInviteFacultyModal()">
                <i class="fas fa-user-plus"></i> Invite Faculty
            </button>
            <button class="btn btn-sm btn-outline-secondary" onclick="openBulkReminderModal()">
                <i class="fas fa-envelope"></i> Send Reminders
            </button>
        </div>
        <button class="panel-toggle">‚ñº</button>
    </div>
    <div class="panel-content">
        <div id="facultyOverviewContainer">
            <div class="panel-loading">
                <div class="spinner-border spinner-border-sm"></div>
                Loading faculty...
            </div>
        </div>
    </div>
</div>

<!-- Panel 6: Course Sections -->
<div class="dashboard-panel" id="institution-sections-panel">
    <div class="panel-header">
        <h5 class="panel-title">
            <span class="panel-icon">üìñ</span>
            Course Sections (Current Term)
        </h5>
        <div class="panel-actions">
            <button class="btn btn-sm btn-outline-primary" onclick="createSection()">
                <i class="fas fa-plus"></i> Add Section
            </button>
            <button class="btn btn-sm btn-outline-secondary" onclick="manageSections()">
                <i class="fas fa-list"></i> Manage Sections
            </button>
        </div>
        <button class="panel-toggle">‚ñº</button>
    </div>
    <div class="panel-content">
        <div id="courseSectionContainer">
            <div class="panel-loading">
                <div class="spinner-border spinner-border-sm"></div>
                Loading sections...
            </div>
        </div>
    </div>
</div>

<!-- Panel 7: Outcome (CLO) Management -->
<div class="dashboard-panel" id="institution-outcome-panel">
    <div class="panel-header">
        <h5 class="panel-title">
            <span class="panel-icon">üéØ</span>
            Course Learning Outcomes (CLOs)
        </h5>
        <div class="panel-actions">
            <button class="btn btn-sm btn-primary" onclick="createOutcome()">
                <i class="fas fa-plus"></i> Add Outcome
            </button>
            <button class="btn btn-sm btn-outline-secondary" onclick="manageOutcomes()">
                <i class="fas fa-list"></i> Manage Outcomes
            </button>
        </div>
        <button class="panel-toggle">‚ñº</button>
    </div>
    <div class="panel-content">
        <div id="outcomeManagementContainer">
            <div class="panel-loading">
                <div class="spinner-border spinner-border-sm"></div>
                Loading outcomes...
            </div>
        </div>
    </div>
</div>

<!-- Panel 8: Assessment Progress -->
<div class="dashboard-panel" id="institution-assessment-panel">
    <div class="panel-header">
        <h5 class="panel-title">
            <span class="panel-icon">üìä</span>
            Assessment Progress
        </h5>
        <div class="panel-actions">
            <button class="btn btn-sm btn-outline-warning" onclick="openBulkReminderModal()">
                <i class="fas fa-bell"></i> Send Reminders
            </button>
        </div>
        <button class="panel-toggle">‚ñº</button>
    </div>
    <div class="panel-content">
        <div id="assessmentProgressContainer">
            <div class="panel-loading">
                <div class="spinner-border spinner-border-sm"></div>
                Loading assessment data...
            </div>
        </div>
    </div>
</div>

<!-- Panel 9: CLO Audit & Approval -->
<div class="dashboard-panel" id="institution-clo-audit-panel">
    <div class="panel-header">
        <h5 class="panel-title">
            <span class="panel-icon">‚úì</span>
            CLO Audit & Approval
        </h5>
        <div class="panel-actions">
            <button class="btn btn-sm btn-primary" onclick="window.location.href='/audit-clo'">
                <i class="fas fa-clipboard-check"></i> Review Submissions
            </button>
        </div>
        <button class="panel-toggle">‚ñº</button>
    </div>
    <div class="panel-content">
        <div id="institutionCloAuditContainer">
            <div class="panel-loading">
                <div class="spinner-border spinner-border-sm"></div>
                Loading audit data...
            </div>
        </div>
    </div>
</div>

<!-- Panel 10: Data Management (Import/Export) -->
{% include 'components/data_management_panel.html' %}

<!-- CRUD Management Modals -->

<!-- Program Management Modals -->
<div class="modal fade" id="createProgramModal" tabindex="-1" aria-labelledby="createProgramModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="createProgramModalLabel">Create New Program</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="createProgramForm">
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="programName" class="form-label">Program Name *</label>
                        <input type="text" class="form-control" id="programName" name="name" required>
                        <small class="form-text text-muted">E.g., "Computer Science", "Nursing"</small>
                    </div>
                    <div class="mb-3">
                        <label for="programShortName" class="form-label">Short Name *</label>
                        <input type="text" class="form-control" id="programShortName" name="short_name" required maxlength="10">
                        <small class="form-text text-muted">Abbreviation, e.g., "CS", "NURS" (auto-uppercased)</small>
                    </div>
                    <div class="mb-3">
                        <label for="programInstitutionId" class="form-label">Institution *</label>
                        <select class="form-control" id="programInstitutionId" name="institution_id" required>
                            <option value="">Select Institution</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="programActive" name="active" checked>
                            <label class="form-check-label" for="programActive">Active</label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="createProgramBtn">
                        <span class="btn-text">Create Program</span>
                        <span class="btn-spinner d-none">
                            <span class="spinner-border spinner-border-sm" aria-hidden="true"></span>
                            Creating...
                        </span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="editProgramModal" tabindex="-1" aria-labelledby="editProgramModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editProgramModalLabel">Edit Program</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="editProgramForm">
                <input type="hidden" id="editProgramId">
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="editProgramName" class="form-label">Program Name *</label>
                        <input type="text" class="form-control" id="editProgramName" required>
                    </div>
                    <div class="mb-3">
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="editProgramActive">
                            <label class="form-check-label" for="editProgramActive">Active</label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <span class="btn-text">Update</span>
                        <span class="btn-spinner d-none">
                            <span class="spinner-border spinner-border-sm" aria-hidden="true"></span>
                            Updating...
                        </span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Course Modals -->
{% include '_course_modals.html' %}

<div class="modal fade" id="editCourseModal" tabindex="-1" aria-labelledby="editCourseModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editCourseModalLabel">Edit Course</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="editCourseForm">
                <input type="hidden" id="editCourseId">
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="editCourseNumber" class="form-label">Course Number *</label>
                            <input type="text" class="form-control" id="editCourseNumber" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="editCourseTitle" class="form-label">Course Title *</label>
                            <input type="text" class="form-control" id="editCourseTitle" required>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="editCourseDescription" class="form-label">Description</label>
                        <textarea class="form-control" id="editCourseDescription" rows="3"></textarea>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="editCourseCreditHours" class="form-label">Credit Hours *</label>
                            <input type="number" class="form-control" id="editCourseCreditHours" min="0" max="12" step="0.5" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="editCourseDepartment" class="form-label">Department</label>
                            <input type="text" class="form-control" id="editCourseDepartment">
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="editCourseProgramIds" class="form-label">Programs *</label>
                        <select class="form-control" id="editCourseProgramIds" multiple size="5" required>
                        </select>
                        <small class="form-text text-muted">Hold Ctrl/Cmd to select multiple</small>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <span class="btn-text">Update</span>
                        <span class="btn-spinner d-none">
                            <span class="spinner-border spinner-border-sm" aria-hidden="true"></span>
                            Updating...
                        </span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Term Management Modals -->
<div class="modal fade" id="createTermModal" tabindex="-1" aria-labelledby="createTermModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="createTermModalLabel">Create New Term</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="createTermForm">
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="termName" class="form-label">Term Name *</label>
                        <input type="text" class="form-control" id="termName" name="name" required placeholder="e.g., FA2024">
                    </div>
                    <div class="mb-3">
                        <label for="termStartDate" class="form-label">Start Date *</label>
                        <input type="date" class="form-control" id="termStartDate" name="start_date" required>
                    </div>
                    <div class="mb-3">
                        <label for="termEndDate" class="form-label">End Date *</label>
                        <input type="date" class="form-control" id="termEndDate" name="end_date" required>
                    </div>
                    <div class="mb-3">
                        <label for="termAssessmentDueDate" class="form-label">Assessment Due Date</label>
                        <input type="date" class="form-control" id="termAssessmentDueDate" name="assessment_due_date">
                    </div>
                    <div class="mb-3">
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="termActive" name="active" checked>
                            <label class="form-check-label" for="termActive">Active</label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="createTermBtn">
                        <span class="btn-text">Create Term</span>
                        <span class="btn-spinner d-none">
                            <span class="spinner-border spinner-border-sm" aria-hidden="true"></span>
                            Creating...
                        </span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="editTermModal" tabindex="-1" aria-labelledby="editTermModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editTermModalLabel">Edit Term</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="editTermForm">
                <input type="hidden" id="editTermId">
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="editTermName" class="form-label">Term Name *</label>
                        <input type="text" class="form-control" id="editTermName" required>
                    </div>
                    <div class="mb-3">
                        <label for="editTermStartDate" class="form-label">Start Date *</label>
                        <input type="date" class="form-control" id="editTermStartDate" required>
                    </div>
                    <div class="mb-3">
                        <label for="editTermEndDate" class="form-label">End Date *</label>
                        <input type="date" class="form-control" id="editTermEndDate" required>
                    </div>
                    <div class="mb-3">
                        <label for="editTermAssessmentDueDate" class="form-label">Assessment Due Date</label>
                        <input type="date" class="form-control" id="editTermAssessmentDueDate">
                    </div>
                    <div class="mb-3">
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="editTermActive">
                            <label class="form-check-label" for="editTermActive">Active</label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <span class="btn-text">Update</span>
                        <span class="btn-spinner d-none">
                            <span class="spinner-border spinner-border-sm" aria-hidden="true"></span>
                            Updating...
                        </span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Offering Management Modals -->
<div class="modal fade" id="createOfferingModal" tabindex="-1" aria-labelledby="createOfferingModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="createOfferingModalLabel">Create New Course Offering</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="createOfferingForm">
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="offeringCourseId" class="form-label">Course *</label>
                        <select class="form-control" id="offeringCourseId" name="course_id" required>
                            <option value="">Select Course</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="offeringTermId" class="form-label">Term *</label>
                        <select class="form-control" id="offeringTermId" name="term_id" required>
                            <option value="">Select Term</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="offeringStatus" class="form-label">Status</label>
                        <select class="form-control" id="offeringStatus" name="status">
                            <option value="active" selected>Active</option>
                            <option value="scheduled">Scheduled</option>
                            <option value="cancelled">Cancelled</option>
                        </select>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="offeringCapacity" class="form-label">Capacity</label>
                            <input type="number" class="form-control" id="offeringCapacity" name="capacity" min="0">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="offeringEnrolled" class="form-label">Currently Enrolled</label>
                            <input type="number" class="form-control" id="offeringEnrolled" name="enrolled" min="0" value="0">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="createOfferingBtn">
                        <span class="btn-text">Create Offering</span>
                        <span class="btn-spinner d-none">
                            <span class="spinner-border spinner-border-sm" aria-hidden="true"></span>
                            Creating...
                        </span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="editOfferingModal" tabindex="-1" aria-labelledby="editOfferingModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editOfferingModalLabel">Edit Course Offering</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="editOfferingForm">
                <input type="hidden" id="editOfferingId">
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="editOfferingCourse" class="form-label">Course</label>
                        <input type="text" class="form-control" id="editOfferingCourse" disabled>
                    </div>
                    <div class="mb-3">
                        <label for="editOfferingTerm" class="form-label">Term</label>
                        <input type="text" class="form-control" id="editOfferingTerm" disabled>
                    </div>
                    <div class="mb-3">
                        <label for="editOfferingStatus" class="form-label">Status</label>
                        <select class="form-control" id="editOfferingStatus">
                            <option value="active">Active</option>
                            <option value="scheduled">Scheduled</option>
                            <option value="cancelled">Cancelled</option>
                        </select>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="editOfferingCapacity" class="form-label">Capacity</label>
                            <input type="number" class="form-control" id="editOfferingCapacity" min="0">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="editOfferingEnrolled" class="form-label">Currently Enrolled</label>
                            <input type="number" class="form-control" id="editOfferingEnrolled" min="0">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <span class="btn-text">Update</span>
                        <span class="btn-spinner d-none">
                            <span class="spinner-border spinner-border-sm" aria-hidden="true"></span>
                            Updating...
                        </span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Section Management Modals -->
<div class="modal fade" id="createSectionModal" tabindex="-1" aria-labelledby="createSectionModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="createSectionModalLabel">Create New Course Section</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="createSectionForm">
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="sectionOfferingId" class="form-label">Course Offering *</label>
                        <select class="form-control" id="sectionOfferingId" name="offering_id" required>
                            <option value="">Select Offering</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="sectionName" class="form-label">Section Name *</label>
                        <input type="text" class="form-control" id="sectionName" name="name" required placeholder="e.g., Section A">
                    </div>
                    <div class="mb-3">
                        <label for="sectionInstructorId" class="form-label">Instructor</label>
                        <select class="form-control" id="sectionInstructorId" name="instructor_id">
                            <option value="">Unassigned</option>
                        </select>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="sectionCapacity" class="form-label">Capacity</label>
                            <input type="number" class="form-control" id="sectionCapacity" name="capacity" min="0">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="sectionEnrolled" class="form-label">Currently Enrolled</label>
                            <input type="number" class="form-control" id="sectionEnrolled" name="enrolled" min="0" value="0">
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <span class="btn-text">Create Section</span>
                        <span class="btn-spinner d-none">
                            <span class="spinner-border spinner-border-sm" aria-hidden="true"></span>
                            Creating...
                        </span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="editSectionModal" tabindex="-1" aria-labelledby="editSectionModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editSectionModalLabel">Edit Course Section</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="editSectionForm">
                <input type="hidden" id="editSectionId">
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="editSectionNumber" class="form-label">Section Number *</label>
                        <input type="text" class="form-control" id="editSectionNumber" required>
                    </div>
                    <div class="mb-3">
                        <label for="editSectionInstructorId" class="form-label">Instructor</label>
                        <select class="form-control" id="editSectionInstructorId">
                            <option value="">Unassigned</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="editSectionEnrollment" class="form-label">Enrollment</label>
                        <input type="number" class="form-control" id="editSectionEnrollment" min="0">
                    </div>
                    <div class="mb-3">
                        <label for="editSectionStatus" class="form-label">Status</label>
                        <select class="form-control" id="editSectionStatus">
                            <option value="scheduled">Scheduled</option>
                            <option value="active">Active</option>
                            <option value="completed">Completed</option>
                            <option value="cancelled">Cancelled</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <span class="btn-text">Update</span>
                        <span class="btn-spinner d-none">
                            <span class="spinner-border spinner-border-sm" aria-hidden="true"></span>
                            Updating...
                        </span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Outcome Management Modals -->
<div class="modal fade" id="createOutcomeModal" tabindex="-1" aria-labelledby="createOutcomeModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="createOutcomeModalLabel">Create New Course Learning Outcome</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="createOutcomeForm">
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="outcomeCourseId" class="form-label">Course *</label>
                        <select class="form-control" id="outcomeCourseId" name="course_id" required>
                            <option value="">Select Course</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="outcomeCloNumber" class="form-label">CLO Number *</label>
                        <input type="number" class="form-control" id="outcomeCloNumber" name="clo_number" required min="1" placeholder="e.g., 1">
                    </div>
                    <div class="mb-3">
                        <label for="outcomeDescription" class="form-label">Description *</label>
                        <textarea class="form-control" id="outcomeDescription" name="description" rows="3" required></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="outcomeAssessmentMethod" class="form-label">Assessment Method</label>
                        <input type="text" class="form-control" id="outcomeAssessmentMethod" name="assessment_method">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <span class="btn-text">Create Outcome</span>
                        <span class="btn-spinner d-none">
                            <span class="spinner-border spinner-border-sm" aria-hidden="true"></span>
                            Creating...
                        </span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="editOutcomeModal" tabindex="-1" aria-labelledby="editOutcomeModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editOutcomeModalLabel">Edit Course Learning Outcome</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="editOutcomeForm">
                <input type="hidden" id="editOutcomeId">
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="editOutcomeCloNumber" class="form-label">CLO Number *</label>
                        <input type="number" class="form-control" id="editOutcomeCloNumber" required min="1">
                    </div>
                    <div class="mb-3">
                        <label for="editOutcomeDescription" class="form-label">Description *</label>
                        <textarea class="form-control" id="editOutcomeDescription" rows="3" required></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="editOutcomeAssessmentMethod" class="form-label">Assessment Method</label>
                        <input type="text" class="form-control" id="editOutcomeAssessmentMethod">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <span class="btn-text">Update</span>
                        <span class="btn-spinner d-none">
                            <span class="spinner-border spinner-border-sm" aria-hidden="true"></span>
                            Updating...
                        </span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Invite Faculty Modal -->
<div class="modal fade" id="inviteFacultyModal" tabindex="-1" aria-labelledby="inviteFacultyModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="inviteFacultyModalLabel">Invite New Instructor</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="inviteFacultyForm">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="inviteFacultyEmail" class="form-label">Email Address *</label>
                        <input type="email" class="form-control" id="inviteFacultyEmail" required 
                               placeholder="instructor@example.com">
                        <div class="form-text">Instructor will receive an invitation email at this address</div>
                    </div>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="inviteFacultyFirstName" class="form-label">First Name *</label>
                            <input type="text" class="form-control" id="inviteFacultyFirstName" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="inviteFacultyLastName" class="form-label">Last Name *</label>
                            <input type="text" class="form-control" id="inviteFacultyLastName" required>
                        </div>
                    </div>
                    
                    <hr class="my-3">
                    <h6 class="mb-3">Course Assignment (Optional)</h6>
                    
                    <div class="mb-3">
                        <label for="inviteFacultyTerm" class="form-label">Term</label>
                        <select class="form-control" id="inviteFacultyTerm">
                            <option value="">No course assignment</option>
                        </select>
                        <div class="form-text">Select a term to assign this instructor to a section</div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="inviteFacultyOffering" class="form-label">Course Offering</label>
                        <select class="form-control" id="inviteFacultyOffering" disabled>
                            <option value="">Select term first</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="inviteFacultySection" class="form-label">Section</label>
                        <select class="form-control" id="inviteFacultySection" disabled>
                            <option value="">Select offering first</option>
                        </select>
                    </div>
                    
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="inviteFacultyReplaceExisting">
                        <label class="form-check-label" for="inviteFacultyReplaceExisting">
                            Replace existing instructor (if section already has one assigned)
                        </label>
                    </div>
                    
                    <div class="alert alert-info mb-0">
                        <i class="fas fa-info-circle"></i>
                        The instructor will receive an email with a link to complete their registration and set their password.
                        If a section is selected, they will be automatically assigned to it upon accepting the invitation.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <span class="btn-text">
                            <i class="fas fa-paper-plane"></i> Send Invitation
                        </span>
                        <span class="btn-spinner d-none">
                            <span class="spinner-border spinner-border-sm" aria-hidden="true"></span>
                            Sending...
                        </span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='logger.js') }}"></script>
<script src="{{ url_for('static', filename='script.js') }}"></script>
<script src="{{ url_for('static', filename='panels.js') }}"></script>
<script src="{{ url_for('static', filename='dashboard_utils.js') }}"></script>
<script src="{{ url_for('static', filename='institution_dashboard.js') }}"></script>

<!-- Load all CRUD management scripts -->
<script src="{{ url_for('static', filename='programManagement.js') }}"></script>
<script src="{{ url_for('static', filename='courseManagement.js') }}"></script>
<script src="{{ url_for('static', filename='termManagement.js') }}"></script>
<script src="{{ url_for('static', filename='offeringManagement.js') }}"></script>
<script src="{{ url_for('static', filename='sectionManagement.js') }}"></script>
<script src="{{ url_for('static', filename='outcomeManagement.js') }}"></script>
<script src="{{ url_for('static', filename='inviteFaculty.js') }}"></script>

<script>
    // Expose user context to JavaScript
    window.userContext = {
        institutionId: '{{ user.institution_id }}',
        institutionName: '{{ user.institution_name }}',
        role: '{{ user.role }}'
    };

    // Institution Data Management Functions
    // Import functions are defined in the Excel import modal (templates/components/excel_import_modal.html)
    
    function institutionQuickExport() {
        const format = document.querySelector('input[name="institutionExportFormat"]:checked').value;
        alert(`Quick Export (${format}) feature coming soon!`);
    }

    function institutionExportData(type) {
        const format = document.querySelector('input[name="institutionExportFormat"]:checked').value;
        alert(`Export ${type} (${format}) feature coming soon!`);
    }

    // Modal Helper Functions - Open CRUD modals
    function createProgram() {
        const modal = new bootstrap.Modal(document.getElementById('createProgramModal'));
        modal.show();
    }

    function managePrograms() {
        alert('Program management list coming soon!');
    }

    function createCourse() {
        const modal = new bootstrap.Modal(document.getElementById('createCourseModal'));
        modal.show();
    }

    function manageCourses() {
        alert('Course management list coming soon!');
    }

    function createTerm() {
        const modal = new bootstrap.Modal(document.getElementById('createTermModal'));
        modal.show();
    }

    function manageTerms() {
        alert('Term management list coming soon!');
    }

    function createOffering() {
        const modal = new bootstrap.Modal(document.getElementById('createOfferingModal'));
        modal.show();
    }

    function manageOfferings() {
        alert('Offering management list coming soon!');
    }

    function createSection() {
        const modal = new bootstrap.Modal(document.getElementById('createSectionModal'));
        modal.show();
    }

    function manageSections() {
        alert('Section management list coming soon!');
    }

    function createOutcome() {
        const modal = new bootstrap.Modal(document.getElementById('createOutcomeModal'));
        modal.show();
    }

    function manageOutcomes() {
        alert('Outcome management list coming soon!');
    }
</script>

<!-- Include Bulk Reminder Modal -->
{% include 'components/bulk_reminder_modal.html' %}

<!-- Bulk Reminder JavaScript -->
<script src="{{ url_for('static', filename='bulk_reminders.js') }}"></script>

{% endblock %}
